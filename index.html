<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MVP Calendario de Clases</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FullCalendar CSS y JS (v5) -->
    <link href='https://cdn.jsdelivr.net/npm/@fullcalendar/core@5.11.3/main.min.css' rel='stylesheet' />
    <link href='https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@5.11.3/main.min.css' rel='stylesheet' />
    <link href='https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@5.11.3/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core@5.11.3/main.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@5.11.3/main.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@5.11.3/main.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@5.11.3/main.min.js'></script>
    <!-- Fuente opcional -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Ajustes para FullCalendar con Tailwind */
        .fc .fc-toolbar-title { @apply text-xl font-semibold text-gray-800; }
        .fc .fc-button-primary { @apply bg-blue-600 border-blue-600 hover:bg-blue-700 hover:border-blue-700; }
        .fc .fc-col-header-cell-cushion { @apply text-gray-700 font-medium; }
        .fc .fc-timegrid-slot-label { @apply text-gray-600; }
    </style>
</head>
<body class="bg-gray-50 p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Cabecera -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-4 md:mb-0">üìÖ Calendario de Clases (MVP)</h1>
            <div class="flex gap-3">
                <button id="openModalBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg shadow transition flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                    A√±adir clase
                </button>
                <button id="todayBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg shadow transition">
                    Hoy
                </button>
            </div>
        </div>

        <!-- Leyenda de profesores -->
        <div class="flex flex-wrap gap-4 mb-4 text-sm">
            <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-blue-500 mr-2"></span> Prof. Ana (Matem√°ticas)</div>
            <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-green-500 mr-2"></span> Prof. Luis (F√≠sica)</div>
            <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-orange-500 mr-2"></span> Prof. Carla (Qu√≠mica)</div>
            <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-purple-500 mr-2"></span> Prof. Marta (Historia)</div>
        </div>

        <!-- Contenedor del calendario -->
        <div id="calendar" class="bg-white p-4 rounded-xl shadow-lg"></div>
    </div>

    <!-- Modal para a√±adir clase (oculto por defecto) -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 mx-4">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">‚ûï Nueva clase</h2>
            <form id="addClassForm">
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">T√≠tulo de la clase</label>
                    <input type="text" id="title" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none" placeholder="Ej. Matem√°ticas avanzadas">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">Profesor</label>
                    <select id="professor" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
                        <option value="Ana">Prof. Ana (Matem√°ticas)</option>
                        <option value="Luis">Prof. Luis (F√≠sica)</option>
                        <option value="Carla">Prof. Carla (Qu√≠mica)</option>
                        <option value="Marta">Prof. Marta (Historia)</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">D√≠a</label>
                        <select id="day" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
                            <option value="1">Lunes</option>
                            <option value="2">Martes</option>
                            <option value="3">Mi√©rcoles</option>
                            <option value="4">Jueves</option>
                            <option value="5">Viernes</option>
                            <option value="6">S√°bado</option>
                            <option value="0">Domingo</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Color</label>
                        <select id="color" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
                            <option value="blue">Azul</option>
                            <option value="green">Verde</option>
                            <option value="orange">Naranja</option>
                            <option value="purple">Morado</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Hora inicio</label>
                        <input type="time" id="startTime" required value="09:00" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Hora fin</label>
                        <input type="time" id="endTime" required value="10:30" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
                    </div>
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" id="closeModalBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition">Cancelar</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">Guardar clase</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        (function() {
            // ----- Configuraci√≥n de semana objetivo (pr√≥ximo lunes) -----
            function getNextMonday() {
                const today = new Date();
                const day = today.getDay(); // 0 domingo, 1 lunes...
                const diff = (day === 0 ? 1 : 8 - day); // d√≠as hasta pr√≥ximo lunes
                const nextMonday = new Date(today);
                nextMonday.setDate(today.getDate() + diff);
                nextMonday.setHours(0,0,0,0);
                return nextMonday;
            }
            const baseDate = getNextMonday(); // lunes de la semana que mostraremos

            // Mapeo de d√≠as (0 domingo..6 s√°bado) a offset desde baseDate
            function getDateForDay(dayIndex) {
                const date = new Date(baseDate);
                // dayIndex: 0 domingo, 1 lunes... 6 s√°bado
                // Si dayIndex es 0 (domingo) y baseDate es lunes, sumamos 6
                if (dayIndex === 0) { // domingo
                    date.setDate(baseDate.getDate() + 6);
                } else {
                    date.setDate(baseDate.getDate() + (dayIndex - 1)); // lunes = 1 -> +0, martes 2 -> +1, etc.
                }
                return date;
            }

            // ----- Datos de ejemplo (eventos iniciales) -----
            const initialEvents = [
                { id: '1', title: 'Matem√°ticas - Ana', professor: 'Ana', day: 1, startTime: '10:00', endTime: '11:30', color: 'blue' },
                { id: '2', title: 'F√≠sica - Luis', professor: 'Luis', day: 2, startTime: '14:00', endTime: '15:30', color: 'green' },
                { id: '3', title: 'Qu√≠mica - Carla', professor: 'Carla', day: 3, startTime: '08:00', endTime: '09:30', color: 'orange' },
                { id: '4', title: 'Historia - Marta', professor: 'Marta', day: 4, startTime: '16:00', endTime: '17:30', color: 'purple' },
                { id: '5', title: 'Matem√°ticas - Ana', professor: 'Ana', day: 5, startTime: '12:00', endTime: '13:30', color: 'blue' },
            ];

            // Convertir eventos iniciales a objetos con start/end Date
            function buildEventsFromArray(arr) {
                return arr.map(e => {
                    const date = getDateForDay(e.day);
                    const [startH, startM] = e.startTime.split(':');
                    const [endH, endM] = e.endTime.split(':');
                    const start = new Date(date);
                    start.setHours(parseInt(startH), parseInt(startM), 0);
                    const end = new Date(date);
                    end.setHours(parseInt(endH), parseInt(endM), 0);
                    return {
                        id: e.id,
                        title: e.title,
                        start: start,
                        end: end,
                        backgroundColor: e.color === 'blue' ? '#3b82f6' : e.color === 'green' ? '#22c55e' : e.color === 'orange' ? '#f97316' : '#a855f7',
                        borderColor: 'white',
                        textColor: 'white',
                        extendedProps: { professor: e.professor }
                    };
                });
            }

            let events = buildEventsFromArray(initialEvents);

            // ----- Inicializar FullCalendar -----
            const calendarEl = document.getElementById('calendar');
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'timeGridWeek',
                initialDate: baseDate,
                headerToolbar: {
                    left: 'prev,next',
                    center: 'title',
                    right: 'timeGridWeek,timeGridDay'
                },
                slotMinTime: '07:00:00',
                slotMaxTime: '21:00:00',
                allDaySlot: false,
                height: 'auto',
                locale: 'es',
                buttonText: {
                    today: 'Hoy',
                    week: 'Semana',
                    day: 'D√≠a'
                },
                events: events,
                eventClick: function(info) {
                    if (confirm('¬øEliminar esta clase?')) {
                        // Eliminar del array y refrescar
                        events = events.filter(e => e.id !== info.event.id);
                        calendar.removeAllEvents();
                        calendar.addEventSource(events);
                    }
                },
                eventDidMount: function(info) {
                    // A√±adir tooltip con profesor
                    info.el.setAttribute('title', `Prof. ${info.event.extendedProps.professor}`);
                }
            });

            calendar.render();

            // ----- L√≥gica del modal -----
            const modal = document.getElementById('modal');
            const openModalBtn = document.getElementById('openModalBtn');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const form = document.getElementById('addClassForm');
            const todayBtn = document.getElementById('todayBtn');

            openModalBtn.addEventListener('click', () => {
                modal.classList.remove('hidden');
            });

            closeModalBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });

            // Cerrar modal si se hace clic fuera del contenido (opcional)
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });

            // Bot√≥n "Hoy" vuelve a la semana actual
            todayBtn.addEventListener('click', () => {
                const today = new Date();
                calendar.gotoDate(today);
            });

            // Manejar env√≠o del formulario
            form.addEventListener('submit', (e) => {
                e.preventDefault();

                const title = document.getElementById('title').value;
                const professor = document.getElementById('professor').value;
                const day = parseInt(document.getElementById('day').value);
                const color = document.getElementById('color').value;
                const startTime = document.getElementById('startTime').value;
                const endTime = document.getElementById('endTime').value;

                // Validar hora inicio < fin
                if (startTime >= endTime) {
                    alert('La hora de fin debe ser posterior a la de inicio');
                    return;
                }

                // Generar ID √∫nico
                const newId = Date.now().toString();

                // Crear evento en el array interno
                const date = getDateForDay(day);
                const [startH, startM] = startTime.split(':');
                const [endH, endM] = endTime.split(':');
                const start = new Date(date);
                start.setHours(parseInt(startH), parseInt(startM), 0);
                const end = new Date(date);
                end.setHours(parseInt(endH), parseInt(endM), 0);

                const newEvent = {
                    id: newId,
                    title: `${title} - ${professor}`,
                    start: start,
                    end: end,
                    backgroundColor: color === 'blue' ? '#3b82f6' : color === 'green' ? '#22c55e' : color === 'orange' ? '#f97316' : '#a855f7',
                    borderColor: 'white',
                    textColor: 'white',
                    extendedProps: { professor: professor }
                };

                // A√±adir al array y refrescar calendario
                events.push(newEvent);
                calendar.addEvent(newEvent);

                // Resetear formulario y cerrar modal
                form.reset();
                // Valores por defecto para comodidad
                document.getElementById('startTime').value = '09:00';
                document.getElementById('endTime').value = '10:30';
                modal.classList.add('hidden');
            });

            // Peque√±o ajuste: forzar recalculo de eventos si cambia baseDate (no deber√≠a)
            // Exponer √∫til para depuraci√≥n
            window.calendar = calendar;
        })();
    </script>
</body>
</html>